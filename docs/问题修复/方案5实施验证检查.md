# æ–¹æ¡ˆ5å®æ–½éªŒè¯æ£€æŸ¥æŠ¥å‘Š

## æ–¹æ¡ˆ5çš„æ ¸å¿ƒè¦æ±‚

æ ¹æ®ä¹‹å‰çš„è®¨è®ºï¼Œ**æ–¹æ¡ˆ5ï¼šæ™ºèƒ½åæ ‡è½¬æ¢å±‚**çš„æ ¸å¿ƒè¦æ±‚å¦‚ä¸‹ï¼š

### âœ… è¦æ±‚1ï¼šä¿®æ”¹ connectedWindow ç±»å‹å®šä¹‰

- æ·»åŠ  `x: number` - çª—å£åœ¨å±å¹•ä¸Šçš„ X åæ ‡
- æ·»åŠ  `y: number` - çª—å£åœ¨å±å¹•ä¸Šçš„ Y åæ ‡

### âœ… è¦æ±‚2ï¼šåœ¨ connectWindow() ä¸­ä¿å­˜çª—å£ä½ç½®

- ä¿å­˜ `targetWindow.x` åˆ° `this.connectedWindow.x`
- ä¿å­˜ `targetWindow.y` åˆ° `this.connectedWindow.y`

### âœ… è¦æ±‚3ï¼šæ·»åŠ  transformCoordinates() æ–¹æ³•

**èŒè´£**ï¼š

- å…¨å±æ¨¡å¼ï¼šç›´æ¥è¿”å›åŸåæ ‡ï¼ˆä¸éœ€è¦è½¬æ¢ï¼‰
- çª—å£æ¨¡å¼ï¼šçª—å£ç›¸å¯¹åæ ‡ + çª—å£å±å¹•ä½ç½® = å±å¹•ç»å¯¹åæ ‡

**ä½ç½®**ï¼šåº”è¯¥åœ¨ `// ==================== åæ ‡è½¬æ¢æ–¹æ³• ====================` éƒ¨åˆ†

### âœ… è¦æ±‚4ï¼šæ‰€æœ‰é¼ æ ‡æ“ä½œæ–¹æ³•è°ƒç”¨è½¬æ¢å±‚

éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ï¼š

1. `mouseClick(x, y)` â†’ å…ˆè°ƒç”¨ `transformCoordinates(x, y)`ï¼Œå†è°ƒç”¨ `windowsNative.mouseClickAsync()`
2. `mouseDoubleClick(x, y)` â†’ åŒä¸Š
3. `mouseRightClick(x, y)` â†’ åŒä¸Š
4. `mouseHover(x, y)` â†’ åŒä¸Š
5. `dragAndDrop(fromX, fromY, toX, toY)` â†’ è½¬æ¢èµ·ç‚¹å’Œç»ˆç‚¹
6. `scrollAt(x, y, ...)` â†’ è½¬æ¢åæ ‡

### âœ… è¦æ±‚5ï¼šèŒè´£åˆ†ç¦»

- **windowsDevice**ï¼šè´Ÿè´£åæ ‡è½¬æ¢ï¼ˆçª—å£ç›¸å¯¹ â†’ å±å¹•ç»å¯¹ï¼‰
- **windowsNative**ï¼šåªè´Ÿè´£æ‰§è¡Œæ“ä½œï¼ˆæ¥æ”¶å±å¹•ç»å¯¹åæ ‡ï¼‰

**å…³é”®**ï¼š`windowsNative` çš„æ–¹æ³•ä¸éœ€è¦ä¿®æ”¹ï¼

---

## å½“å‰å®æ–½çŠ¶æ€æ£€æŸ¥

### âŒ æ£€æŸ¥ç‚¹1ï¼šconnectedWindow ç±»å‹å®šä¹‰

**åº”è¯¥**ï¼š

```typescript
private connectedWindow: {
  id: number;
  title: string;
  x: number; // â† å¿…é¡»æ·»åŠ 
  y: number; // â† å¿…é¡»æ·»åŠ 
  width: number;
  height: number;
} | null = null;
```

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½** - æ–‡ä»¶å·²è¢«æ¢å¤ï¼Œéœ€è¦é‡æ–°æ·»åŠ 

---

### âŒ æ£€æŸ¥ç‚¹2ï¼šconnectWindow() ä¿å­˜ä½ç½®ä¿¡æ¯

**åº”è¯¥**ï¼š

```typescript
this.connectedWindow = {
  id: targetWindow.id,
  title: targetWindow.title,
  x: targetWindow.x, // â† å¿…é¡»æ·»åŠ 
  y: targetWindow.y, // â† å¿…é¡»æ·»åŠ 
  width: targetWindow.width,
  height: targetWindow.height,
};
```

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½** - æ–‡ä»¶å·²è¢«æ¢å¤ï¼Œéœ€è¦é‡æ–°æ·»åŠ 

---

### âŒ æ£€æŸ¥ç‚¹3ï¼štransformCoordinates() æ–¹æ³•

**åº”è¯¥å­˜åœ¨çš„æ–¹æ³•**ï¼š

```typescript
/**
 * åæ ‡è½¬æ¢ï¼šå°†çª—å£ç›¸å¯¹åæ ‡è½¬æ¢ä¸ºå±å¹•ç»å¯¹åæ ‡
 */
private transformCoordinates(x: number, y: number): { x: number; y: number } {
  if (!this.connectedWindow) {
    // å…¨å±æ¨¡å¼ï¼šä¸éœ€è¦è½¬æ¢
    return { x, y };
  }

  // çª—å£æ¨¡å¼ï¼šè¿›è¡Œè¾¹ç•Œæ£€æµ‹
  let adjustedX = x;
  let adjustedY = y;

  if (x < 0 || y < 0 || 
      x > this.connectedWindow.width || 
      y > this.connectedWindow.height) {
    console.warn(`âš ï¸ åæ ‡ (${x}, ${y}) è¶…å‡ºçª—å£èŒƒå›´ï¼Œè‡ªåŠ¨è£å‰ª`);
    adjustedX = Math.max(0, Math.min(x, this.connectedWindow.width - 1));
    adjustedY = Math.max(0, Math.min(y, this.connectedWindow.height - 1));
  }

  // è½¬æ¢ä¸ºå±å¹•ç»å¯¹åæ ‡
  const screenX = adjustedX + this.connectedWindow.x;
  const screenY = adjustedY + this.connectedWindow.y;

  if (this.options.debug) {
    console.log(
      `ğŸ”„ åæ ‡è½¬æ¢: çª—å£ç›¸å¯¹ (${x}, ${y}) â†’ å±å¹•ç»å¯¹ (${screenX}, ${screenY})`,
    );
  }

  return { x: screenX, y: screenY };
}
```

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½** - æ–‡ä»¶å·²è¢«æ¢å¤ï¼Œéœ€è¦é‡æ–°æ·»åŠ 

---

### âŒ æ£€æŸ¥ç‚¹4ï¼šé¼ æ ‡æ“ä½œæ–¹æ³•è°ƒç”¨è½¬æ¢å±‚

#### 4.1 mouseClick()

**åº”è¯¥**ï¼š

```typescript
private async mouseClick(x: number, y: number): Promise<void> {
  this.assertNotDestroyed();
  
  // â† å¿…é¡»æ·»åŠ ï¼šåæ ‡è½¬æ¢
  const transformed = this.transformCoordinates(x, y);
  
  if (this.options.debug) {
    console.log(`ğŸ–±ï¸ Mouse click at (${x}, ${y}) â†’ screen (${transformed.x}, ${transformed.y})`);
  }
  
  await windowsNative.mouseClickAsync(transformed.x, transformed.y);
}
```

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½** - ä»ç„¶æ˜¯ç›´æ¥è°ƒç”¨ `windowsNative.mouseClickAsync(x, y)`

---

#### 4.2 mouseDoubleClick()

**åº”è¯¥**ï¼šåŒä¸Šï¼Œè°ƒç”¨ `transformCoordinates()`

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½**

---

#### 4.3 mouseRightClick()

**åº”è¯¥**ï¼šåŒä¸Šï¼Œè°ƒç”¨ `transformCoordinates()`

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½**

---

#### 4.4 mouseHover()

**åº”è¯¥**ï¼šåŒä¸Šï¼Œè°ƒç”¨ `transformCoordinates()`

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½**

---

#### 4.5 dragAndDrop()

**åº”è¯¥**ï¼š

```typescript
private async dragAndDrop(
  fromX: number,
  fromY: number,
  toX: number,
  toY: number,
): Promise<void> {
  this.assertNotDestroyed();

  // â† å¿…é¡»æ·»åŠ ï¼šè½¬æ¢èµ·ç‚¹å’Œç»ˆç‚¹
  const transformedFrom = this.transformCoordinates(fromX, fromY);
  const transformedTo = this.transformCoordinates(toX, toY);

  if (this.options.debug) {
    console.log(
      `ğŸ–±ï¸ Drag from (${fromX}, ${fromY}) â†’ screen (${transformedFrom.x}, ${transformedFrom.y}) to (${toX}, ${toY}) â†’ screen (${transformedTo.x}, ${transformedTo.y})`,
    );
  }

  await windowsNative.dragAndDropAsync(
    transformedFrom.x,
    transformedFrom.y,
    transformedTo.x,
    transformedTo.y,
  );
}
```

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½**

---

#### 4.6 scrollAt()

**åº”è¯¥**ï¼š

```typescript
private async scrollAt(
  x: number,
  y: number,
  direction: 'up' | 'down' | 'left' | 'right',
  distance: number,
): Promise<void> {
  this.assertNotDestroyed();

  // â† å¿…é¡»æ·»åŠ ï¼šåæ ‡è½¬æ¢
  const transformed = this.transformCoordinates(x, y);

  if (this.options.debug) {
    console.log(
      `ğŸ”„ Scroll ${direction} at (${x}, ${y}) â†’ screen (${transformed.x}, ${transformed.y}) by ${distance}px`,
    );
  }

  await windowsNative.scrollAtAsync(
    transformed.x,
    transformed.y,
    direction,
    distance,
  );
}
```

**å½“å‰çŠ¶æ€**ï¼šâŒ **æœªå®æ–½**

---

### âœ… æ£€æŸ¥ç‚¹5ï¼šèŒè´£åˆ†ç¦»

**è¦æ±‚**ï¼š

- `windowsNative` çš„æ–¹æ³•ä¸åº”è¯¥ä¿®æ”¹
- `windowsNative` æ¥æ”¶çš„åº”è¯¥æ˜¯å±å¹•ç»å¯¹åæ ‡

**å½“å‰çŠ¶æ€**ï¼šâœ… **ç¬¦åˆ** - `windowsNative` çš„ä»£ç æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œç¬¦åˆæ–¹æ¡ˆ5çš„è®¾è®¡

---

## æ€»ç»“

### âŒ **å½“å‰å®æ–½çŠ¶æ€ï¼šæœªå®Œæˆ**

æ–‡ä»¶ä¼¼ä¹è¢«æ¢å¤åˆ°äº†åŸå§‹çŠ¶æ€ï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½ä¸¢å¤±äº†ã€‚éœ€è¦é‡æ–°å®æ–½ä»¥ä¸‹å†…å®¹ï¼š

1. âœ… **æ–¹æ¡ˆè®¾è®¡æ­£ç¡®** - æ–¹æ¡ˆ5çš„è®¾è®¡æ€è·¯å®Œå…¨ç¬¦åˆè¦æ±‚
2. âŒ **ä»£ç æœªå®æ–½** - æ‰€æœ‰5ä¸ªæ£€æŸ¥ç‚¹éƒ½æœªå®æ–½
3. âœ… **èŒè´£åˆ†ç¦»æ­£ç¡®** - æ–¹æ¡ˆè®¾è®¡ç¬¦åˆè¦æ±‚ï¼ˆä¸éœ€è¦ä¿®æ”¹ windowsNativeï¼‰

### éœ€è¦é‡æ–°å®æ–½

æ ¹æ®æ–¹æ¡ˆ5çš„è¦æ±‚ï¼Œéœ€è¦é‡æ–°åº”ç”¨ä»¥ä¸‹ä¿®æ”¹ï¼š

1. **ä¿®æ”¹ connectedWindow ç±»å‹**ï¼ˆæ·»åŠ  x, yï¼‰
2. **ä¿®æ”¹ connectWindow()**ï¼ˆä¿å­˜ x, yï¼‰
3. **æ·»åŠ  transformCoordinates() æ–¹æ³•**
4. **ä¿®æ”¹æ‰€æœ‰ 6 ä¸ªé¼ æ ‡æ“ä½œæ–¹æ³•**ï¼ˆè°ƒç”¨è½¬æ¢å±‚ï¼‰

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

å»ºè®®é‡æ–°å®Œæ•´å®æ–½æ–¹æ¡ˆ5ï¼Œç¡®ä¿ï¼š

1. æ‰€æœ‰ä¿®æ”¹éƒ½æ­£ç¡®åº”ç”¨
2. ä»£ç ç¬¦åˆæ–¹æ¡ˆ5çš„è¦æ±‚
3. è¿›è¡Œå®Œæ•´çš„éªŒè¯æµ‹è¯•
